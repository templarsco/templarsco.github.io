<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="favicon.svg" type="image/svg+xml" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login — lightweight.</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: #0a0a0a;
        color: #fff;
      }
      .mono {
        font-family: "JetBrains Mono", monospace;
      }
    </style>
  </head>
  <body class="min-h-screen flex items-center justify-center">
    <div class="w-full max-w-md px-6">
      <div class="text-center mb-10">
        <a
          href="index.html"
          class="inline-flex items-center gap-2 text-2xl font-bold mb-2"
        >
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" fill="none" class="w-7 h-7">
            <path d="M18.5 3L8 17h7l-1.5 12L24 15h-7l1.5-12z" stroke="#22C55E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <span>lightweight<span class="text-[#22C55E]">.</span></span>
        </a>
        <p class="text-white/50 text-sm">Sign in to get your API key</p>
      </div>

      <div class="bg-[#111111] border border-white/5 rounded-2xl p-8">
        <div id="login-view">
          <button
            onclick="login()"
            class="w-full flex items-center justify-center gap-3 bg-white text-black font-semibold rounded-xl px-6 py-3.5 hover:bg-white/90 transition-colors cursor-pointer"
          >
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
              <path
                d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"
              />
            </svg>
            Continue with GitHub
          </button>

          <div class="mt-6 pt-6 border-t border-white/5">
            <p class="text-white/40 text-sm text-center mb-4">
              Have an invite code?
            </p>
            <div class="flex gap-2">
              <input
                id="invite"
                type="text"
                placeholder="Enter invite code"
                class="flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-2.5 text-sm mono placeholder:text-white/20 focus:outline-none focus:border-[#22C55E]/50"
              />
              <button
                onclick="redeem()"
                class="bg-[#22C55E]/10 text-[#22C55E] border border-[#22C55E]/20 rounded-xl px-4 py-2.5 text-sm font-medium hover:bg-[#22C55E]/20 transition-colors cursor-pointer"
              >
                Redeem
              </button>
            </div>
          </div>
        </div>

        <div id="callback-view" class="hidden text-center py-8">
          <div
            class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-[#22C55E]/10 mb-4"
          >
            <svg
              class="w-6 h-6 text-[#22C55E] animate-spin"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83"
              />
            </svg>
          </div>
          <p class="text-white/70 text-sm">Completing sign in...</p>
        </div>

        <div id="success-view" class="hidden text-center py-8">
          <div
            class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-[#22C55E]/10 mb-4"
          >
            <svg
              class="w-6 h-6 text-[#22C55E]"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M20 6L9 17l-5-5" />
            </svg>
          </div>
          <p class="text-white font-semibold mb-1">You're in!</p>
          <p class="text-white/50 text-sm mb-6">Your API key is ready</p>
          <a
            href="dashboard.html"
            class="inline-flex items-center gap-2 bg-[#22C55E] text-black font-semibold rounded-xl px-6 py-3 hover:bg-[#22C55E]/90 transition-colors"
          >
            Go to Dashboard
            <svg
              class="w-4 h-4"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M5 12h14M12 5l7 7-7 7" />
            </svg>
          </a>
        </div>

        <div id="error-view" class="hidden text-center py-8">
          <div
            class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-red-500/10 mb-4"
          >
            <svg
              class="w-6 h-6 text-red-400"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M18 6L6 18M6 6l12 12" />
            </svg>
          </div>
          <p class="text-white font-semibold mb-1">Something went wrong</p>
          <p id="error-msg" class="text-white/50 text-sm mb-6">
            Please try again.
          </p>
          <button
            onclick="reset()"
            class="text-[#22C55E] text-sm font-medium hover:underline cursor-pointer"
          >
            Try again
          </button>
        </div>
      </div>

      <p class="text-center text-white/30 text-xs mt-8">
        By signing in, you agree to our terms of service.
        <br />Invite-only beta — limited availability.
      </p>
    </div>

    <script>
      const API = "https://api.lightweight.one";

      function login() {
        const invite = document.getElementById('invite').value.trim();
        if (!invite) {
          document.getElementById('invite').focus();
          document.getElementById('invite').classList.add('border-red-500/50');
          return;
        }
        window.location.href = `${API}/auth/invite?code=${encodeURIComponent(invite)}`;
      }

      function redeem() {
        login();
      }

      function reset() {
        document.getElementById("login-view").classList.remove("hidden");
        document.getElementById("error-view").classList.add("hidden");
        document.getElementById("callback-view").classList.add("hidden");
      }

      async function handleCallback() {
        const params = new URLSearchParams(window.location.search);
        const key = params.get("api_key");
        const login = params.get("login");
        const avatar = params.get("avatar_url");
        const tier = params.get("tier");
        const error = params.get("error");

        if (error) {
          document.getElementById("login-view").classList.add("hidden");
          document.getElementById("error-view").classList.remove("hidden");
          document.getElementById("error-msg").textContent =
            decodeURIComponent(error);
          return;
        }

        if (!key) return;

        document.getElementById("login-view").classList.add("hidden");
        document.getElementById("callback-view").classList.remove("hidden");

        localStorage.setItem("lw_api_key", key);
        localStorage.setItem(
          "lw_user",
          JSON.stringify({ login, avatar_url: avatar, tier, og: false }),
        );

        await new Promise((r) => setTimeout(r, 800));

        document.getElementById("callback-view").classList.add("hidden");
        document.getElementById("success-view").classList.remove("hidden");

        history.replaceState(null, "", "login.html");
      }

      if (localStorage.getItem("lw_api_key")) {
        window.location.href = "dashboard.html";
      } else if (
        window.location.search.includes("api_key") ||
        window.location.search.includes("error")
      ) {
        handleCallback();
      }
    </script>
  </body>
</html>
